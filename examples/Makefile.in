# Standard installation pathnames
# See the file LICENSE for the license
SHELL = @SHELL@
VERSION = @PACKAGE_VERSION@
basesrcdir = $(shell basename `pwd`)
srcdir = @srcdir@
prefix  = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
mandir = @mandir@

CC = @CC@
CFLAGS = @CFLAGS@ -Wall -I. -I@srcdir@/..
CPPFLAGS = @CPPFLAGS@ 
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@

INSTALL = $(srcdir)/../install-sh 

COMPILE         = $(CC) $(CPPFLAGS) $(CFLAGS)
LINK            = $(CC) $(CFLAGS) $(LDFLAGS) $(LIBS)

LINT		= splint
LINTFLAGS	= +quiet -weak -warnposix -unrecog -Din_addr_t=uint32_t -Du_int=unsigned -Du_char=uint8_t -preproc

HEADER		= config.h
SOURCES 	= ldns-read-zone.c \
		  ldns-mx.c \
		  ldns-chaos.c \
		  ldns-update.c \
		  ldns-keygen.c \
		  ldns-key2ds.c \
		  ldns-signzone.c \
		  ldns-version.c \
		  ldns-rrsig.c \
		  ldns-walk.c \
		  ldns-threshold-update.c  \
		  ldns-zsplit.c \
		  ldns-zcat.c \
		  ldns-dpa.c \
		  ldnsd.c


PROGRAMS=$(SOURCES:.c=)

.PHONY:	all clean realclean

all:	$(PROGRAMS)

ldns-read-zone: 	ldns-read-zone.o
			$(LINK) -o $@ $+

ldns-mx: 	ldns-mx.o
		$(LINK) -o $@ $+

ldns-chaos: 	ldns-chaos.o
		$(LINK) -o $@ $+

ldns-update: 	ldns-update.o
		$(LINK) -o $@ $+

ldns-version:	ldns-version.o
		$(LINK) -o $@ $+

ldns-signzone:	ldns-signzone.o
		$(LINK) -o $@ $+

ldns-keygen:	ldns-keygen.o
		$(LINK) -o $@ $+

ldns-key2ds:	ldns-key2ds.o
		$(LINK) -o $@ $+

ldns-rrsig:	ldns-rrsig.o
		$(LINK) -o $@ $+

ldns-walk:	ldns-walk.o
		$(LINK) -o $@ $+

ldns-dpa:	ldns-dpa.o
		$(LINK) -o $@ $+

ldns-zsplit:	ldns-zsplit.o
		$(LINK) -o $@ $+

ldns-zcat:	ldns-zcat.o
		$(LINK) -o $@ $+

ldnsd:		ldnsd.o
		$(LINK) -o $@ $+

ldns-threshold-update:	ldns-threshold-update.o
		$(LINK) -o $@ $+

## implicit rule
%.o: 	$(srcdir)/%.c
	$(COMPILE) -c $<

lint:
	for i in $(SOURCES); do \
		$(LINT) $(LINTFLAGS) -I. -I$(srcdir) $(srcdir)/$$i $(CPPFLAGS); \
		if [ $$? -ne 0 ] ; then exit 1 ; fi ; \
	done

clean:
	rm -f *.o
	rm -f $(PROGRAMS)

realclean: clean
	rm -rf autom4te.cache/
	rm -f config.log config.status aclocal.m4 config.h.in configure Makefile
	rm -f config.h

confclean: clean
	rm -rf config.log config.status config.h Makefile

install:	$(PROGRAMS)
		$(INSTALL) -d -m 755 $(DESTDIR)$(bindir)
		$(INSTALL) -d -m 755 $(DESTDIR)$(mandir)
		$(INSTALL) -d -m 755 $(DESTDIR)$(mandir)/man1
		for i in $(PROGRAMS); do \
			${INSTALL} -c $$i $(DESTDIR)$(bindir) ; \
			$(INSTALL) -c -m 644 $$i.1 $(DESTDIR)$(mandir)/man1/$$i.1 ; \
			done
		exit 0


uninstall:
		for i in $(PROGRAMS); do \
			rm -f $(DESTDIR)$(bindir)/$$i ; \
			rm -f $(DESTDIR)$(mandir)/man1/$$i.1 ; \
			done
		exit 0
		rmdir -p $(DESTDIR)$(bindir)
		rmdir -p $(DESTDIR)$(mandir)
